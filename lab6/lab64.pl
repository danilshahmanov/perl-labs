use strict;
use warnings;

my $enc866 = 
"\x80\x81\x82\x83\x84\x85\xF0\x86\x87\x88\x89\x8A\x8B\x8C\x8D\x8E\x8F\x90\x91
\x92\x93\x94\x95\x96\x97\x98\x99\x9A\x9B\x9C\x9D\x9E\x9F\xA0\xA1\xA2\xA3\xA4\
xA5\xF1\xA6\xA7\xA8\xA9\xAA\xAB\xAC\xAD\xAE\xAF\xE0\xE1\xE2\xE3\xE4\xE5\xE6\
xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF";

my $encKOI8 = 
"\xE1\xE2\xF7\xE7\xE4\xE5\xB3\xF6\xFA\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF2\xF3
\xF4\xF5\xE6\xE8\xE3\xFE\xFB\xFD\xFF\xF9\xF8\xFC\xE0\xF1\xC1\xC2\xD7\xC7\xC4\
xC5\xA3\xD6\xDA\xC9\xCA\xCB\xCC\xCD\xCE\xCF\xD0\xD2\xD3\xD4\xD5\xC6\xC8\xC3\
xDE\xDB\xDD\xDF\xD9\xD8\xDC\xC0\xD1";

my $encWin1251 = 
"\xC0\xC1\xC2\xC3\xC4\xC5\xA8\xC6\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF\xD0\xD1
\xD2\xD3\xD4\xD5\xD6\xD7\xD8\xD9\xDA\xDB\xDC\xDD\xDE\xDF\xE0\xE1\xE2\xE3\xE4\
xE5\xB8\xE6\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF1\xF2\xF3\xF4\xF5\xF6\
xF7\xF8\xF9\xFA\xFB\xFC\xFD\xFE\xFF";

print "Введите файл для преобразования:";
chomp(my $path = <>);

print "Преобразование из win1251 в dos866...\n";
conv($path, $encWin1251, $enc866, "dos866");
print "Преобразовано из win1251 в dos866 в файл converted_dos866.txt\n";

print "Преобразование из dos866 в koi8...\n";
conv("converted_dos866.txt", $enc866, $encKOI8, "koi8");
print "Преобразовано из dos866 в koi8 в файл converted_koi8.txt\n";

sub save_to_file {
    my ($content, $file_name) = @_;
    open my $fh, ">", $file_name or die "Невозможно открыть файл: $!";
    print $fh $content;
    close $fh;
}

sub conv { 
    my ($path, $enc_in, $enc_out, $filename) = @_;
    open my ($fd), "+<", $path or die("Невозможно открыть файл $path"); 
    my $content = join("", <$fd>); 
    eval "\$content =~ tr/$_[1]/$_[2]/"; # меняем кодировку
    close $fd; 

    # Сохраняем результат конвертации в отдельный файл
    save_to_file($content, "converted_$filename.txt");
}
